<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="fr" xml:lang="fr">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="description" content="Animation horloge 2017" />
  <title>Animation d'une horloge analogique par Gabriel Medina</title>
  <link rel="stylesheet" type="text/css" href="StyleLabo5.css" />  
 
  <!-- Code JavaScript local -->
  <script type="text/javascript">
      var objcanvas = null;
      var objc2d = null;
	  var objCycleAnimation = null;
      var objImage = new Image();
      let annee, mois, jour, heure, minute, seconde, milliseconde;
      
      function initAnimation() {
        objcanvas = document.getElementById('monCanvas');
	    objc2d = objcanvas.getContext('2d');
        objImage.src = './Assets/luneJaune.png';  
        calculerTemps(annee,mois,jour,heure,minute,seconde)
        
	    dessinerHorloge(); // Dessiner une première fois
	    animer(); 
      }
      
      function animer() {
        // Requête pour le prochain cycle
        objCycleAnimation = requestAnimationFrame(animer);
	
	    // Le cycle d'animation
	    effacerDessin();
	    mettreAJourAnimation();
	    dessinerHorloge();
      }
      
      function effacerDessin() {
	    objc2d.clearRect(0,0, objcanvas.width, objcanvas.height); 
      }

      function mettreAJourAnimation()
      {
		calculerTemps();
      }
	
      function arreterAnimation()
      {
	    if (objCycleAnimation != null)
	        cancelAnimationFrame(objCycleAnimation);	
		objCycleAnimation = null
      }
      
      function dessinerHorloge() {
		objc2d.save();
            const X_centre = objcanvas.height/2;
            const Y_centre = objcanvas.width/2;
            const chiffresRomains = ["XII","I","II","III","IV","V","VI","VII","VIII","IX","X","XI"];
            const COULEUR = "lavender";
            const COULEUR_FOND = 'black';

            /* Fond d'écran */
            objc2d.fillStyle = COULEUR_FOND;
            objc2d.beginPath();
            objc2d.rect(0,0,550,550);
            objc2d.fill();

            /*Image*/
            
            // objImage.onload = ()=>{
                //    Image coin Sup-Gauche à 25,25 et une taille de 500 * 500 px
                objc2d.drawImage(objImage,25,25,500,500);  
                /* Cercle intérieur */ 
                objc2d.globalCompositeOperation = 'source-over';
                tracerCercle(objc2d, COULEUR, X_centre, Y_centre , 200);
    
                /* Point au centre */
                // objc2d.globalCompositeOperation = 'lighter';
                tracerCercle(objc2d, COULEUR, X_centre, Y_centre, 1, 10);
    
                tracerChiffresEtGraduations(objc2d, chiffresRomains, COULEUR, X_centre, Y_centre,225);
                
                tracerAiguilles(objc2d,COULEUR,10,10,0,X_centre,Y_centre,225);

                heureDigitale(objc2d,objcanvas,COULEUR,heure,minute,seconde);
                affichageDate(objc2d,objcanvas,COULEUR,jour,mois,annee);
            // }			
		objc2d.restore();
      }

      const tracerCercle = (contexteCanvas, strCouleur, xCentre, yCentre, rayon, intEpaisseur)=>{
            contexteCanvas.strokeStyle = strCouleur;
            contexteCanvas.lineWidth = intEpaisseur? intEpaisseur: 1 ;
            contexteCanvas.beginPath();
            contexteCanvas.arc(xCentre , yCentre, rayon, 0, 2 * Math.PI, false);
            contexteCanvas.stroke();
        }

        const affichageDate =(contexteCanvas, canvas, strCouleur, strJour, strMois, strAnnee) =>{
            contexteCanvas.save();
            var strTexte = `${strJour}/${strMois}/${strAnnee}`;

            contexteCanvas.beginPath();
            contexteCanvas.translate(canvas.height/2, 1*canvas.width/3 -50 + 20);
            contexteCanvas.strokeStyle = strCouleur;
            contexteCanvas.fillStyle = strCouleur;
            contexteCanvas.font = '20pt Arial';
            contexteCanvas.textAlign = 'center';
            contexteCanvas.textBaseline = 'middle';
            contexteCanvas.fillText(strTexte, 0, 0);
            contexteCanvas.stroke();
            
            contexteCanvas.beginPath();
            contexteCanvas.fillStyle = strCouleur;
            contexteCanvas.lineWidth = 2;
            var textSize = contexteCanvas.measureText(strTexte);
            contexteCanvas.rect(-textSize.width/2-5,-textSize.fontBoundingBoxDescent-7,textSize.width+2+7,2*textSize.fontBoundingBoxDescent+7);
            contexteCanvas.stroke();
            
            contexteCanvas.restore();
        }

        const heureDigitale = (contexteCanvas, canvas, strCouleur, strHeures, strMinutes, strSecondes) =>{
            contexteCanvas.save();
            var strTexte = `${strHeures}:${strMinutes}:${strSecondes}`;

            contexteCanvas.beginPath();
            contexteCanvas.translate(canvas.height/2, 2*canvas.width/3 + 20);
            contexteCanvas.strokeStyle = strCouleur;
            contexteCanvas.fillStyle = strCouleur;
            contexteCanvas.font = '20pt Arial';
            contexteCanvas.textAlign = 'center';
            contexteCanvas.textBaseline = 'middle';
            contexteCanvas.fillText(strTexte, 0, 0);
            contexteCanvas.stroke();
            
            contexteCanvas.beginPath();
            contexteCanvas.fillStyle = strCouleur;
            contexteCanvas.lineWidth = 2;
            var textSize = contexteCanvas.measureText(strTexte);
            contexteCanvas.rect(-textSize.width/2,-textSize.fontBoundingBoxDescent-2,textSize.width+2,2*textSize.fontBoundingBoxDescent);
            contexteCanvas.stroke();
            
            contexteCanvas.restore();
        }

        const tracerAiguilles = (contexteCanvas, strCouleur, intHeure, intMinute, intSeconde, xCentre, yCentre, rayonHorloge) =>{
            
            // Début des itérations
            contexteCanvas.save();
            contexteCanvas.translate(xCentre,yCentre);  // CENTRÉ
            contexteCanvas.rotate(-Math.PI/2)           // VERS 12 (Début)
            
            // Aiguille heures 
            contexteCanvas.save();
            contexteCanvas.rotate(heure*Math.PI/6+(minute/60)*Math.PI/6);  /// SELON HEURE (RotationHeure + fraction de minute)
            contexteCanvas.fillStyle = strCouleur;
            contexteCanvas.beginPath();
            contexteCanvas.fillRect(-10,-3,2*rayonHorloge/3+5,6);
            contexteCanvas.restore()

            // Aiguille minutes
            contexteCanvas.save();
            contexteCanvas.rotate(minute*Math.PI/30+(seconde/60)*Math.PI/30);      // Rotation minute + fraction seconds
            contexteCanvas.fillStyle = strCouleur;
            contexteCanvas.beginPath();
            contexteCanvas.fillRect(-20,-2,rayonHorloge,4);
            contexteCanvas.restore()

            // Aiguille des secondes
            contexteCanvas.save();
            contexteCanvas.rotate(seconde*Math.PI/30+(milliseconde/1000)*Math.PI/30);    // Rotation secondes + fraction millisecondes
            contexteCanvas.fillStyle = strCouleur;
            contexteCanvas.beginPath();
            contexteCanvas.fillRect(-20,-1,rayonHorloge,2);
            contexteCanvas.restore();


            contexteCanvas.restore();

        }

        const tracerChiffresEtGraduations = (contexteCanvas, tableauChiffres, strCouleur, xCentre, yCentre, rayon)=> {
        
            // Translation du contexte au centre du cercle
            contexteCanvas.save()
            contexteCanvas.translate(xCentre,yCentre);
            contexteCanvas.rotate(-Math.PI/2);
            for(let i=0 ; i<60; i++){
                if(i%5==0){
                    contexteCanvas.strokeStyle = strCouleur;
                    contexteCanvas.beginPath();
                    contexteCanvas.save(); // Je veux conserver le contexte de la fonction

                    /* Définition d'un nouveau contexte local de la boucle For */
                    contexteCanvas.translate(rayon-5,0);
                    contexteCanvas.rotate(Math.PI/2);
                    var numRomain = tableauChiffres[i/5];
                    contexteCanvas.fillStyle = strCouleur;
                    contexteCanvas.font = '18pt Arial';
                    contexteCanvas.textAlign = 'center';
                    contexteCanvas.fillText(numRomain,0,0);
                    contexteCanvas.stroke();
    
                    contexteCanvas.restore();
                    contexteCanvas.save();
    
                    contexteCanvas.beginPath();
                    contexteCanvas.fillStyle = strCouleur;
                    contexteCanvas.translate(rayon-20,0);
                    contexteCanvas.rotate(Math.PI/2);
                    contexteCanvas.rect(0,0,5,8);
                    contexteCanvas.fill();
                    
                    contexteCanvas.restore();
                    
                }else{
                    contexteCanvas.save();
    
                    contexteCanvas.beginPath();
                    contexteCanvas.fillStyle = strCouleur;
                    contexteCanvas.translate(rayon-20,0);
                    contexteCanvas.rotate(Math.PI/2);
                    contexteCanvas.rect(0,0,1,4);
                    contexteCanvas.fill();
                    
                    contexteCanvas.restore();
                }
                contexteCanvas.rotate(Math.PI / 30);
            }
            contexteCanvas.restore();
        }
        
        const calculerTemps = () => {
            const maintenant = new Date();
            annee = maintenant.getFullYear();
            mois = maintenant.getMonth()<10? "0"+maintenant.getMonth():maintenant.getMonth();
            jour = maintenant.getDate()<10 ? "0"+maintenant.getDate(): maintenant.getDate();
            heure = maintenant.getHours()<10 ? "0"+maintenant.getHours(): maintenant.getHours();
            minute = maintenant.getMinutes()<10 ? "0"+maintenant.getMinutes(): maintenant.getMinutes();
            seconde = maintenant.getSeconds()<10 ? "0"+maintenant.getSeconds(): maintenant.getSeconds(); 
            milliseconde = maintenant.getMilliseconds();
        }

   </script>
</head>

<body onload="initAnimation()">

    <header class="sTexteCentre sLargeurDiv sEntete">
        <p> 
            <span class="sTitreApp">
                Animation d'une horloge analogique<br />
            </span> par 
            <span class="sAuteurApp">
                Gabriel Medina
            </span> 
       </p>
    </header>

    <main class="sLargeurDiv sCorps">	
	   <canvas id="monCanvas" width="550" height="550">
		    Votre navigateur ne supporte pas la balise canvas
	    </canvas>
    </main>

    <footer class="sLargeurDiv sPiedDePage">
        <p>
            <a href="http://www.cgodin.qc.ca">
                <img src="logoCGG.jpg" alt="logoCGG" />
            </a> 
 			<a href="http://www.cgodin.qc.ca/programme/techniques-informatique/">
	           Département d'informatique du Cégep Gérald-Godin
	        </a> 
            <br />
            &copy; 2026
        </p>
    </footer>
</body>
</html>